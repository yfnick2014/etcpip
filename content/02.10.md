#技巧10 记住TCP/IP不是轮询
对可获得的网络带宽的消耗是TCP不提供网络中断立即通知的一个原因。TCP不提供即使连接中断通知的最重要的原因是TCP需要利用它的一个主要设计目标：网络突然中断时仍可以维持通信的能力。

迫使应用程序实现连接监控的一个缺点就是代码必须内置到每一个应用程序（需要监控连接的应用程序），而且一些不成熟的实现可能浪费带宽或者导致其他对网络和其他用户有害的影响。

##Keep-Alive
TCP提供了一个称作keep-alive的机制用于检测死连接。如果应用程序启用keep-alive机制时，TCP就会在连接已经空闲了一定时间间隔后发送一个特殊的段给对等方。

如果对等方可到达而且对等方应用程序仍然运行，对等方TCP就会响应一个ACK应答。在这种情况下，TCP发送keep-alive重置空闲时间为零，并且应用程序不会接收到消息交换的任何通知。

如果对等方主机可以到达但是对等方应用程序没有运行，对等方TCP就响应RST消息，发送keep-alive消息的TCP撤销连接并返回ECONNRESET错误给应用程序。这通常是对等方主机崩溃后重启的结果。

如果对等方主机没有响应ACK或RST消息，发送keep-alive消息的TCP继续发送keep-alive探询消息，直到它认为对等方不可到达或已经崩溃了。这时它就撤销连接并通知应用程序ETIMEDOUT错误，如果路由器已经返回主机或网络不可到达的ICMP消息的话，就返回EHOSTUNREACH或ENETUNREACH错误。

需要即时通知网络中断的应用程序使用keep-alive功能的第一个问题是和时间间隔有关的。另一个问题是它们不仅仅检测死连接，同时也撤销它们。

##Heartbeats
通过在应用程序中实现一个相同的机制就可以轻松地解决使用keep-alive监控连接中断带来的问题。