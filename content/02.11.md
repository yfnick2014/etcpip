#技巧11 为来自对等方的不合要求的行为做准备
> 软件应当编写成能够处理任何想象的到的错误，不管该错误可能发生的概率是如何的小；数据包迟早会以错误和属性的特定组合到达，除非软件已经为错误做好了准备，否则难免会发生混乱。
> 通常，最好假定网络充满着恶意的实体，它们会发送特意设计的具有最坏影响的数据包。该假设将导致相应的保护设计，尽管在Internet上发生的最严重的问题是由小概率事件触发的不可预料机制导致的；
> 仅仅是人类的恶意永远也不会导致如此曲折的路径！

##检查客户端终止
客户端正常退出TCP发送FIN消息给对等方TCP，服务器读取并返回EOF字符。服务器必须检测它。对于客户端异常终止，实现heartbeat来检测客户端中断并不是必须的。程序只需要在读操作附近放一个计时器，如果客户端在一段时间内没有任何请求，服务器就可以断定客户端已经断开了。

如果我们关心的仅仅是服务器不会永远挂起，那么程序就可以使用keep-alive，在keep-alive计时器时间到头时退出连接。为了防止服务器很长时间挂起，可以通过调用setsockopt启用keep-alive。

##检查输入的有效性
在编写任何类型的程序时有一个共同的原则，那就是不能假定应用程序将只会接收它计划处理的那些数据。应用程序崩溃的两个主要原因是：缓冲区溢出和指针失控。